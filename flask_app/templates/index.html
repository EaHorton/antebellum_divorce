<!doctype html>
<html>
<head>
  <meta charset="utf-8">
  <title>DV Petitions Explorer</title>
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.6.2/dist/css/bootstrap.min.css">
</head>
<body>
<div class="container mt-3">
  <h1>DV Petitions Explorer</h1>
  <form method="GET" action="/">
    <div class="form-row">
      <div class="form-group col-md-4">
        <label>Table</label>
        <select name="table" class="form-control">
          {% for t in tables %}
            <option value="{{t}}" {% if t==table %}selected{% endif %}>{{t}}</option>
          {% endfor %}
        </select>
      </div>
      <div class="form-group col-md-2">
        <label>Rows</label>
        <input type="number" name="nrows" value="{{nrows}}" class="form-control" />
      </div>
      <div class="form-group col-md-4">
        <label>WHERE clause (without WHERE)</label>
        <input type="text" name="where" value="{{where}}" class="form-control" />
      </div>
      <div class="form-group col-md-2 align-self-end">
        <button class="btn btn-primary">Preview</button>
      </div>
    </div>
  </form>

  {% with messages = get_flashed_messages(with_categories=true) %}
    {% if messages %}
      {% for category, msg in messages %}
        <div class="alert alert-{{category}}">{{msg}}</div>
      {% endfor %}
    {% endif %}
  {% endwith %}

  {% if preview is not none %}
    <h3>Preview</h3>
    <div class="mb-2">
      <a class="btn btn-secondary" href="/download?table={{table}}&nrows={{nrows}}&where={{where}}">Download CSV</a>
      <a class="btn btn-secondary" href="/plot?table={{table}}">Visualize</a>
    </div>
    {{ preview.to_html(classes='table table-striped', index=False) | safe }}
  {% endif %}
</div>
</body>
</html>